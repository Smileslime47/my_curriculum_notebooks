
# 算术运算

---
## BCD码
* 组合型（压缩型/装配型/PACKED）
    * 一个字节包含两个BCD码，即两位10进制数
<table>
    <tr>
        <td>7</td>
        <td>6</td>
        <td>5</td>
        <td>4</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0</td>
    </tr>
    <tr>
        <td colspan=4>BCD码(高位)</td>
        <td colspan=4>BCD码(低位)</td>
    </tr>
</table>

* 非组合型（非压缩型/拆散型/UNPACKED）
    * 一个字节的第四位表示一个BCD码，高四位无影响，固定为0000B或者0011B
<table>
    <tr>
        <td>7</td>
        <td>6</td>
        <td>5</td>
        <td>4</td>
        <td>3</td>
        <td>2</td>
        <td>1</td>
        <td>0</td>
    </tr>
    <tr>
        <td colspan=4></td>
        <td colspan=4>BCD码</td>
    </tr>
</table>

### 十进制运算
十进制运算的两种方法：
* 数制转换
    * 先把十进制转换为二进制数，然后用二进制运算指令进行运算，再转换为十进制
* 直接运算
    * 使用BCD码运算指令进行直接运算


BCD码运算的两种方法：
* 指令系统提供专门的BCD码运算的指令
* 用二进制数的运算指令对BCD码进行运算，然后用BCD码矫正指令进行结果矫正
    * 8086使用此种运算方法

---
## BCD码矫正指令
### 非组合型加法矫正指令
* 格式：AAA

对一位存于AL的十进制数进行矫正

使用前**必须**使用ADD/ADC完成了加法指令，且结果存于AL中

过程：
* 若AL[0-3]>9||AF==1
    * AL<=(AL)+6
    * AL[4-7]<=0000
    * AH<=(AH)+1
    * AF<=1,CF<=1

### 组合型加法矫正指令
* 格式：DAA

对二位存于AL的十进制数进行矫正

使用前**必须**使用ADD/ADC完成了加法指令，且结果存于AL中

过程：
* 若AL[0-3]>9||AF==1
    * AL<=(AL)+6
    * AF<=1
* 若AL[4-7]>9||CF==1
    * AL<=(AL)+60H
    * CF<=1

### 非组合型减法矫正指令
* 格式：AAS

对一位存于AL的十进制数进行矫正

使用前**必须**使用SUB/SBB完成了减法指令，且结果存于AL中

过程：
* 若AL[0-3]>9||AF==1
    * AL<=(AL)-6
    * AL[4-7]<=0000
    * AH<=(AH)-1
    * AF<=1,CF<=1

### 组合型减法矫正指令
* 格式：DAS

对二位存于AL的十进制数进行矫正

使用前**必须**使用SUB/SBB完成了减法指令，且结果存于AL中

过程：
* 若AL[0-3]>9||AF==1
    * AL<=(AL)-6
    * AF<=1
* 若AL[4-7]>9||CF==1
    * AL<=(AL)-60H
    * CF<=1

---
## 乘除法运算
### 无符号数乘法指令MUL
* 格式：MUL [OPRD]

* 字节运算：AX<=(AL)x(OPRD)
* 字运算：DX:AX<=(AX)x(OPRD)

只影响CF和OF标志位，若AH（字节运算）/DX（字运算）均为0，则CF=OF=0  
反之则CF=OF=1

### 有符号数乘法指令IMUL
* 格式：IMUL [OPRD]

除OPRD是带符号数以外与MUL相同

若乘积结果的高半部（AH/DX）是低半部的符号扩展（正数补0，负数补1），则CF=OF=0  
反之则CF=OF=1

### 无符号数除法指令DIV
* 格式：DIV [OPRD]

* 字节运算：AL<=(AX)/(OPRD),AH<=(AX)%(OPRD)
* 字运算：AX<=(DX:AX)/(OPRD),DX<=(DX:AX)%(OPRD)

对标志位无影响

下述情况将产生0型中断，转入除法出错处理
* (OPRD)==0
* 商>0FFH(-127~+127)(字节运算)/商>0FFFFH(-32767~+32767)(字运算)

### 带符号数除法指令IDIV
* 格式：IDIV [OPRD]

除OPRD是带符号数以外与DIV相同

### 扩展指令CBW/CWD
* 格式：CBW/CWD

主要用于除法指令之前，形成双倍长度的被除数以适应除数长度

隐含使用AL/AX，对标志位无影响

功能：
* CBW：将AL的符号位扩展到AH中
* CWD：将AX的符号位扩展到DX中
