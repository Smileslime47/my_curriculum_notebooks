[汇编语言基础](../汇编语言设计.md)
# 8086微处理器
<!-- TOC -->

- [8086微处理器](#8086微处理器)
  - [功能结构](#功能结构)
    - [通用寄存器](#通用寄存器)
    - [非通用寄存器](#非通用寄存器)
    - [标志寄存器](#标志寄存器)
  - [存储器组织](#存储器组织)
    - [地址和内容](#地址和内容)
    - [分段](#分段)
    - [地址计算](#地址计算)
    - [段寄存器](#段寄存器)

<!-- /TOC -->
---
## 功能结构
CPU：运算器和控制器集成在一个芯片上  
寄存器：8086有
* 8个通用寄存器
* 2个特殊寄存器
* 4个段寄存器

### 通用寄存器
* 数据寄存器
  |16bit|high-8bit|low-8bit|含义
  |:----:|:----:|:----:|:---:|
  |AX|AH|AL|累加寄存器|
  |BX|BH|BL|基址寄存器|
  |CX|CH|CL|计数寄存器|
  |DX|DH|DL|数据寄存器|
* 指针寄存器
  * SP：堆栈指针寄存器
    * 当前堆栈中栈顶的偏移地址
  * BP：基址指针寄存器
    * 堆栈中某一存储单元的偏移地址
* 变址寄存器
  * SI：源地址变址寄存器
  * DI：目标地址变址寄存器
  * 在字符串操作中SI、DI具有自动增/减量的功能

### 非通用寄存器
* 控制寄存器
  * IP：指令指针寄存器
    * 下一条指令的偏移地址，由CPU自动设置，无法直接改变
  * FLAGS：标志寄存器
* 段寄存器
  * CS：代码段寄存器
    * 不能修改
  * DS：数据段寄存器
  * ES：附加段寄存器
  * SS：堆栈段寄存器

### 标志寄存器

|D15|14|13|12|11|10|9|8|D7|6|5|4|3|2|1|0|
|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|----|
|||||OF|DF|IF|TF|SF|ZF||AF||PF||CF|

* 状态标志：
  * AF：辅助加位标志位
    * 记录运算时第三位（半个字节）产生的进位，与操作数长度无关
  * CF：进位标志
    * 进行算术运算时最高为产生进位（+）/借位（-）则CF=>1，否则CF=>0
  * OF：溢出标志
    * 在运算过程中，操作数溢出则OF=>1
  * PF：奇偶标志
    * 若操作结果的低八位含1为偶数，则PF=>1
  * SF：符号标志
    * 若操作结果为负则SF=>1
  * ZF：零标志位
    * 若操作结果为0则ZF=>1
* 控制标志
  * DF：方向标志
  * IF：中断标志
  * TF：调试标志

符号表示：
|标志名|置1|置0|
|:----|----|----|
|OF溢出（是/否|OV|NV|
|DF方向（增量/减量）|DN|UP|
|IF中断（允许/关闭）|EI|DI|
|SF符号（负/正）|NG|PL|
|ZF零（是/否）|ZR|NZ|
|AF辅助进位（是/否）|AC|NZ|
|PF奇偶（偶/奇）|PE|PO|
|CF进位（是/否）|CY|NC|

---
## 存储器组织
**实模式**（实地址存储管理操作模式）：程序、数据运行在实际的存储空间，无存储保护  
实模式存储管理方式：分段管理方式

### 地址和内容
* 地址
  * 将存储单元编号，用十六进制（H）表示
  * 每个**单元地址**占16bit（字）
  * 每个存储单元都有对应物理地址
  * 对于多字节单元
    * 低位存于低地址，高位存于高地址
    * 地址只取**低8位数据的16位地址**（小端方式）
* 内容
  * 每个**单元内容**占8bit（字节）
  * 为了与地址区分，在表示时地址应加()
  
例子：
|地址|数据|
|----|----|
|0004H|34H|
|0005H|12H|

对于字节有  
* (0004H)=34H
  
对于字有
* (0004H)=1234H

### 分段
8086的地址总线为20位，可寻址的最大范围为$2^{20}$B=1MB  
8086的数据总线为16/8位，可存下的最大地址为$2^{16}$B=64KB  
即无法直接用16/8位存储器存下20位地址

在IBM PC中采用了**存储器地址分段**的方法，把1MB的存储空间分为若干个段（SEGMENT）  
每个段由1～64KB（16位，即65536B）个连续的字节单元组成，每个段是一个可独立寻址的逻辑单位。

在计算20位的物理地址时，通过**16位的段地址**和**16位的偏移地址**来计算获得

* 基本规则：对段起始地址有限制，必须从任一小段的首地址开始
* PC机规定从0开始，每16Byte为1小段

|小段序号|偏移地址|||||
|:----:|----|----|----|----|----|
|1|0000|0001|0002|...|000F|
|2|0010|0011|0012|...|001F|
|...||||||

### 地址计算
* 段地址：一个段的首地址
* 偏移地址：段内相对于首地址的偏移值
  * 若偏移量为0FFFFH，即为段末
* 逻辑地址：由段地址和偏移地址组成，均为无符号16bit数
* 物理地址=段地址x10H+偏移地址
  * 即将段地址左移4位，末尾补0再加上偏移地址，得到20位的物理地址
  * 如2280H:0800H=22800+800=23000H

### 段寄存器
在8086中，代码段段段地址存放在CS中，其他段同理  
**段分配**：每个段可以独立占有64KB空间，也可以**部分或完全重叠**

16位段寻址组合
|段|偏移|用途|
|----|----|----|
|CS|IP|指令寻址|
|SS|SP/BP|堆栈寻址|
|DS|BX/DI/SI/16bit数|数据寻址|
|ES|串指令DI|目标串寻址|