
# 分页存储管理方式

---
## 离散分配方式
* 分页存储管理方式
* 分段存储管理方式
* 段页存储管理方式

---
## 基本方法
### 页面和物理块
将进程的逻辑地址空间分成若干个大小相同的**页**，并对其编号
* 逻辑页和物理块一一对应，一个页号对应一个块号（序号不一定相等，大小相等），页号+页内地址可转换为块号+块内地址
* 页大小满足$2^k$
* 页地址结构
    * 给定一逻辑地址空间A，页面大小为L,则页号P和页内地址D为
    * $P=INT[\frac{A}{L}](向下取整),D=[A]MOD L$
    * 如页大小为4096Byte，第二页存在物理块11，则逻辑地址2F6A对应块号为11，位移量为3946，物理地址为11*4096+3946=BF6A

|31-------12|11-------0|
|----|----|
|页号p|位移量w|

* 页表
    * 运行进程将各个页离散分布，系统为进程创建页面映射表

---
## 地址变换机构
### 基本变换机构
运行期间需要频繁对地址空间中的逻辑地址变换为内存空间的物理地址  
页表存放了各个页的页号及其对应的块号
页表功能通过一组专门的寄存器实现，一个页表项（页表的始址和长度）用一个寄存器存储  
转换时通过页表寄存器中的信息和逻辑地址共同得到物理地址
* 由页表始址找到页表，在页表中找到页号对应块号
* 由页内地址得到块内偏移量
* 例
    * 页大小为1024Byte，页表项大小为20
    * 虚拟地址2500转换为页号2，位移量为452
    * 页号2大于等于页表大小则中断，否则继续
    * 页号2与页表始址1000运算（1000+2*20）得到页表项地址为1040
    * 从页表项读出块号对应8
    * 块号8与位移量452运算（8*1024+452）得到9644（同上例）

### 具有快表的地址变换机构
CPU在存取数据时需要访问两次内存
1. 访问内存中的页表找到对应物理地址
2. 从第一次的物理地址找到内存的数据

增设具有并行查询能力的**特殊高速缓冲寄存器**，称为**联想寄存器**/**快表**

---
### 访问内存的有效时间
**内存有效访问时间**（Effective Access Time a.k.a. EAT）：从进程发出指定逻辑地址访问请求，经过地址变换，在内存中找到对应实际物理地址单元并取出数据花费的总时间

设访问一次内存的平均时间为t，则在未引入快表时
* $EAT = t + t = 2t$

由于快表的容量限制，不能将进程的整个页表全部装入快表，故引入命中率

**命中率**：使用快表并成功在其中查找到所需页面的比率

设查找快表所需时间为λ，命中率为a，访问一次内存的平均时间为t，则
* $EAT = a \times \lambda + (t + \lambda)(1 - a) + t = 2t + \lambda - t \times a$

---
## 多级页表
### 两级页表
对于难以找到大的连续内存空间存放页表，可采用将页表分页的方式  
也要为离散分配的页表再建立一张页表，称为**外层页表**（Outer Page Table）  
同样需要一个外层页表寄存器，存放外层页表的始址和长度

---
## 反置页表
一般页表项按照页号进行排序，页表项内容为物理块号  
反置页表为每一个物理设置页表项，按照物理块号进行排序，页表项内容为页号

### 地址变换
* 根据进程标识符和页号，去检索反置页表
* 检索到匹配页表项则对应序号即为物理块号
* 若为找到匹配页表项则说明此页为装入内存
    * 对于不具有请求调页的存储系统，抛出地址错误
    * 对于具有请求调页的存储系统，产生请求调页中断