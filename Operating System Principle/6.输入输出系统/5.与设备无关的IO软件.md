[输入输出系统](../操作系统原理.md)
# 与设备无关的IO软件
<!-- TOC -->

- [与设备无关的IO软件](#与设备无关的io软件)
  - [基本概念](#基本概念)
    - [逻辑设备名](#逻辑设备名)
    - [名称转换](#名称转换)
  - [与设备无关的软件](#与设备无关的软件)
  - [设备分配](#设备分配)
    - [数据结构](#数据结构)
    - [考虑因素](#考虑因素)
    - [分配程序](#分配程序)
  - [设备名映射](#设备名映射)
    - [逻辑设备表（Logical Unit Table a.k.a. LUT）](#逻辑设备表logical-unit-table-aka-lut)

<!-- /TOC -->
---
## 基本概念
**基本含义**：应用程序中所用的设备，不局限于某个具体的物理设备
### 逻辑设备名
早期应用程序在使用IO设备时使用设备的物理名称，应用程序与系统中的物理设备直接相关  
为了实现与设备的无关性，引入了**逻辑设备**和**物理设备**的概念

### 名称转换
系统只会识别物理设备名称，在实际执行时，需要使用设备的物理名称  
在系统中，需要具有将逻辑设备名称转换为物理设备名称的功能

--
## 与设备无关的软件 
* 设备驱动程序的统一接口
    * 要求每个设备驱动程序与OS之间有着相同的接口，简化添加新驱动的步骤
    * 将抽象的设备名映射到适当的驱动程序上，找到相应设备的驱动入口
    * 对设备进行保护，防止无权的用户使用设备
* 缓冲管理
* 差错控制
* 对独立设备的分配与回收
* 独立于设备的逻辑数据块


-- 
## 设备分配
### 数据结构
* 设备控制表DCT
    * 设备类型
    * 设备标识符
    * 设备状态
    * 指向控制器表的指针
    * 重复执行次数或时间
    * 设备队列的队首指针
* 控制器表COCT
    * 控制器标识符
    * 控制器状态
    * 与控制器链接的通道表指针
    * 控制器队列的队首指针
    * 控制器队列的队尾指针
* 通道控制表CHCT
    * 通道标识符
    * 通道状态
    * 与通道连接的控制器表首址
    * 通道队列的队首指针
    * 通道队列的队尾指针
* 系统设备表SDT
    * 设备类
    * 设备标识符
    * DCT 
    * 驱动程序入口

### 考虑因素
* 设备的固有属性
    * 独占设备的分配策略
    * 共享设备的分配策略
    * 虚拟设备的分配策略
        * 属于可共享设备，可同时分配给多个进程使用
* 设备分配算法（通常只使用以下算法）
    * 先来先服务
    * 高优先级优先
* 安全性
    * 安全分配方式
        * 每次进程发出IO后进入阻塞状态，完成IO操作才被唤醒
    * 不安全分配方式
        * 进程发出IO后继续进行，可继续发出请求，请求设备被其他进程占用才阻塞

### 分配程序
使用逻辑设备名请求IO

---
## 设备名映射
### 逻辑设备表（Logical Unit Table a.k.a. LUT）
* 在整个系统中设置一张LUT

|逻辑设备名|物理设备名|驱动入口|
|----|----|----|
|/dev/tty|3|1024|
|/dev/printer|5|2046|

* 为每个用户设置一张LUT

|逻辑设备名|系统设备表指针|
|----|----|
|/dev/tty|3|
|/dev/printer|5|

