[输入输出系统](../操作系统原理.md)
# 用户层的IO软件
<!-- TOC -->

- [用户层的IO软件](#用户层的io软件)
  - [系统调用与库函数](#系统调用与库函数)
    - [系统调用](#系统调用)
    - [库函数](#库函数)
  - [假脱机系统（SPOOLing）](#假脱机系统spooling)
    - [假脱机技术](#假脱机技术)
    - [组成](#组成)
    - [SPOOLing的特点](#spooling的特点)
    - [假脱机打印系统](#假脱机打印系统)
    - [守护进程（daemon）](#守护进程daemon)

<!-- /TOC -->
---
## 系统调用与库函数
### 系统调用
* 不允许运行在用户态的应用进程直接去调用运行在核心态的OS过程
* 应用程序在运行时又必须取得OS提供的服务

**系统调用**：应用程序可以通过它间接调用OS的IO过程，对IO设备进行操作

### 库函数
* 在UNIX系系统及C语言中
    * 系统调用与各系统调用所用的库函数一一对应
* 在Windows系统中
    * 微软定义了称为Win32 API的应用程序接口
    * 该接口与实际的系统调用不一定一一对应

```mermaid
    graph LR;
        用户进程-->|调用文件操作接口|文件系统;
        文件系统-->|转换为内核函数|设备驱动;
        设备驱动-->|调用设备服务例程|设备控制器;
        设备控制器-->|控制设备|硬件设备;
```

---
## 假脱机系统（SPOOLing）
可将一台IO设备虚拟为多台设备，多用户共享
### 假脱机技术
利用外围控制机，将低速IO设备的数据传送到高速磁盘上或相反  
当处理机需要输入数据时可以直接从磁盘中读取数据  
当处理机需要输出数据时可以很快地先把数据输出到磁盘，然后继续做自己的事情

### 组成
* 输入井和输出井
* 输入缓冲区和输出缓冲区
* 输入进程和输出进程
* 井管理程序

![]()

### SPOOLing的特点
* 提高了IO速度
* 将独占设备虚拟为共享设备
* 实现了虚拟设备的功能

### 假脱机打印系统
打印机属于独占设备，利用SPOOLing可将其改造为多用户共享的打印设备
* 磁盘缓冲区
* 打印缓冲区
* 假脱机管理进程
* 假脱机打印进程

### 守护进程（daemon）
取消原来的假脱机管理进程，由一个守护进程执行其一部分功能
* 如为其申请空闲盘块，将打印数据送入其中然后返回盘块始址

另一部分由请求进程自己完成
* 如生成打印请求文件，包含对打印的要求和指向输出数据盘块的指针等信息，将其放入假脱机文件队列